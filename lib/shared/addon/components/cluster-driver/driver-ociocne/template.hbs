{{#accordion-list showExpandAll=false as |al expandFn|}}

{{!-- Only allow edits to tenancy, compartment, and region configuration for new cluster --}}
  {{#accordion-list-item title=(t "clusterNew.ociocne.access.title")
                         detail=(t "clusterNew.ociocne.access.detail")
                         expandAll=expandAll
                         expand=(action expandFn)
                         expandOnInit=true
  }}
    <div class="row">
      <div class="col span-6">
        <label class="acc-label">
          {{t 'clusterNew.ociocne.tenancyOCID.label'}}{{field-required}}
        </label>
        {{#input-or-display editable=isNew value=config.tenancyId}}
          {{input type="text" name="tenancy" classNames="form-control" placeholder=(t 'clusterNew.ociocne.tenancyOCID.placeholder') value=config.tenancyId}}
        {{/input-or-display}}
      </div>

      <div class="col span-6">
        <label class="acc-label">
          {{t 'clusterNew.ociocne.region.label'}}{{field-required}}
        </label>
        {{#if (and (eq step 1) isNew)}}
          <select class="form-control" onchange={{action (mut config.region) value="target.value"}}>
            {{#each authRegionChoices as |choice|}}
              <option value={{choice}} selected={{eq config.region choice}}>{{choice}}</option>
            {{/each}}
          </select>
          <p class="help-block">
            {{t 'clusterNew.ociocne.region.help'}}
          </p>
        {{else}}
          <div>{{config.region}}</div>
        {{/if}}
      </div>

    </div>

    {{!-- Allow edits to user details for both new and existing cluster --}}
    <div class="row">

      <div class="col span-6">
        <label class="acc-label">
          {{t 'clusterNew.ociocne.userOcid.label'}}{{field-required}}
        </label>
        {{#input-or-display editable=(or isNew editing) value=config.userOcid}}
          {{input type="text" name="username" classNames="form-control" placeholder=(t 'clusterNew.ociocne.userOcid.placeholder') value=config.userOcid}}
        {{/input-or-display}}
      </div>

      <div class="col span-6">
        <label class="acc-label">
          {{t 'clusterNew.ociocne.userFingerprint.label'}}{{field-required}}
        </label>
        {{#input-or-display editable=(or isNew editing) value=config.fingerprint}}
          {{input type="text" name="fingerprint" classNames="form-control" placeholder=(t 'clusterNew.ociocne.userFingerprint.placeholder') value=config.fingerprint}}
        {{/input-or-display}}
      </div>

    </div>
    <div class="row">
      <div class="col span-6">
        <label class="acc-label">
          {{t 'clusterNew.ociocne.compartmentId.label'}}{{field-required}}
        </label>
        {{#input-or-display editable=(and (eq step 1) isNew) value=config.compartmentId}}
          {{input type="text" name="compartment" classNames="form-control" placeholder=(t 'clusterNew.ociocne.compartmentId.placeholder') value=config.compartmentId}}
        {{/input-or-display}}
      </div>
      <div class="col span-6">
        <label class="acc-label">
          {{t 'clusterNew.ociocne.secretKeyPassphrase.label'}}
        </label>
        {{#input-or-display editable=(or isNew editing) value=config.privateKeyPassphrase}}
          {{input type="password" name="password" classNames="form-control" concealValue=true placeholder=(t 'clusterNew.ociocne.secretKeyPassphrase.placeholder') value=config.privateKeyPassphrase}}
        {{/input-or-display}}
      </div>

    </div>
    <div class="row">

      <div class="col span-6">
        <label class="acc-label pt-5">{{t "clusterNew.ociocne.secretKey.label"}}{{field-required}}</label>
      </div>
      {{input-text-file
        classNames="box"
        value=config.privateKeyContents
        multiple=False
        canChangeName=false
        accept="text/plain,.pem,.pkey,.key"
        minHeight=40
        placeholder="clusterNew.ociocne.secretKey.placeholder"
        shouldChangeName=false
        concealValue=true
      }}

    </div>
  {{/accordion-list-item}}

  {{!-- authenticate to OCI --}}
  {{#if (eq step 1)}}
    {{save-cancel editing=false
                  save="saveStep1"
                  cancel=close
                  saveDisabled=canAuthenticate
                  createLabel="clusterNew.ociocne.access.next"
                  savingLabel="clusterNew.ociocne.access.loading"
    }}
  {{/if}}

  {{#if (and (gte step 3) editing)}}
  {{!-- edit cluster --}}
    {{#accordion-list-item title=(t "clusterNew.ociocne.cluster.title")
                           detail=(t "clusterNew.ociocne.cluster.detail")
                           showExpand=false
                           expandOnInit=true
                           expandAll=al.expandAll
                           expand=(action expandFn)
    }}
      <div class="row">
        <div class="col span-4">
          <label class="acc-label">
            {{t 'clusterNew.ociocne.version.label'}}
          </label>
          {{#if (eq step 3)}}
            <select class="form-control" onchange={{action (mut config.kubernetesVersion) value="target.value"}}>
              <option>  </option>
              {{#each kubernetesVersions as |choice|}}
                {{#if (lte config.kubernetesVersion choice)}}
                  <option value={{choice}} selected={{eq config.kubernetesVersion choice}}>{{choice}}</option>
                {{/if}}
              {{/each}}
            </select>
          {{else}}
            <div>{{config.kubernetesVersion}}</div>
          {{/if}}
        </div>

        <div class="col span-4 mb-0">
          <label class="acc-label">
            {{t 'clusterNew.ociocne.numControlPlaneNodes.label'}}
          </label>
          {{#input-or-display editable=(or (eq mode "new") eq mode "editing")value=config.numControlPlaneNodes}}
            {{input-integer min=0 max=maxNodeCount value=config.numControlPlaneNodes classNames="form-control" placeholder=(t 'clusterNew.ociocne.numControlPlaneNodes.placeholder')}}
            <p class="help-block">
              {{t 'clusterNew.ociocne.numControlPlaneNodes.help'}}
            </p>
          {{/input-or-display}}
        </div>

        <div class="col span-4">
          <label class="acc-label">
            {{t 'clusterNew.ociocne.numWorkerNodes.label'}}
          </label>
          {{#input-or-display editable=(or (eq mode "new") eq mode "editing") value=config.numWorkerNodes}}
            {{input-integer min=0 max=maxNodeCount value=config.numWorkerNodes classNames="form-control" placeholder=(t 'clusterNew.ociocne.numWorkerNodes.placeholder')}}
            <p class="help-block">
              {{t 'clusterNew.ociocne.numWorkerNodes.help'}}
            </p>
          {{/input-or-display}}
        </div>

      </div>

    {{/accordion-list-item}}

    {{!-- exit point for update/upgrade --}}
    {{save-cancel editing=(eq mode 'edit')
                  save="upgradeCluster"
                  cancel=close
    }}
    {{#if refresh}}

    {{/if}}

  {{else}}
  {{!-- new cluster --}}
    {{#if (gte step 2)}}
      {{#accordion-list-item title=(t "clusterNew.ociocne.networking.title")
                             detail=(t "clusterNew.ociocne.networking.detail")
                             showExpand=false
                             expandOnInit=true
                             expandAll=al.expandAll
                             expand=(action expandFn)
      }}


        <div class="row">
          <div class="col span-6">
            {{#input-or-display
              editable=(not-eq mode "view")
              value=(if vcnCreationMode (t "generic.enabled") (t "generic.disabled"))
            }}
              <div class="radio">
                <label>
                  {{radio-button
                    selection=vcnCreationMode
                    disabled=(and (eq step 2) isNew)
                    value="Quick"
                    disabled=(if multipleRegistries true false)
                  }}
                  {{t 'clusterNew.ociocne.vcn.quick'}}
                  <p class="help-block">
                    {{t 'clusterNew.ociocne.vcn.quickHelp'}}
                  </p>
                </label>
              </div>
              {{#if (eq vcnCreationMode "Quick")}}
                <div>
                  <b>{{t 'clusterNew.ociocne.vcn.quickResources.header'}}</b>
                  <ul>
                    <li>{{t 'clusterNew.ociocne.vcn.quickResources.vcn'}}</li>
                    <li>{{t 'clusterNew.ociocne.vcn.quickResources.igw'}}</li>
                    <li>{{t 'clusterNew.ociocne.vcn.quickResources.nat'}}</li>
                    <li>{{t 'clusterNew.ociocne.vcn.quickResources.sgw'}}</li>
                  </ul>
                </div>
              {{/if}}
              <div class="radio">
                <label>
                  {{radio-button
                    selection=vcnCreationMode
                    disabled=(and (eq step 2) isNew)
                    value="Existing"
                    disabled=(if multipleRegistries true false)
                  }}
                  {{t 'clusterNew.ociocne.vcn.existing'}}
                </label>
                <p class="help-block">
                  {{t 'clusterNew.ociocne.vcn.existingHelp'}}
                </p>
              </div>

              {{#if (eq vcnCreationMode "Existing")}}
                <div class="row">

                  <div class="col span-6">
                    <label class="acc-label">{{t 'clusterNew.ociocne.vcnId.label'}}{{field-required}}</label>
                    {{#input-or-display editable=(and (eq step 2) isNew) value=config.vncId}}
                      {{input type="text" classNames="form-control" placeholder=(t 'clusterNew.ociocne.vcnId.placeholder') value=config.vcnId}}
                    {{/input-or-display}}
                  </div>
                </div>
                <div class="row">
                  <div class="col span-6">
                    <label class="acc-label">{{t 'clusterNew.ociocne.controlPlaneSubnet.label'}}{{field-required}}</label>
                    {{#input-or-display editable=(and (eq step 2) isNew) value=config.controlPlaneSubnet}}
                      {{input type="text" classNames="form-control" placeholder=(t 'clusterNew.ociocne.controlPlaneSubnet.placeholder') value=config.controlPlaneSubnet}}
                    {{/input-or-display}}
                  </div>
                  <div class="col span-6">
                    <label class="acc-label">{{t 'clusterNew.ociocne.loadBalancerSubnet.label'}}{{field-required}}</label>
                    {{#input-or-display editable=(and (eq step 2) isNew) value=config.loadBalancersubnet}}
                      {{input type="text" classNames="form-control" placeholder=(t 'clusterNew.ociocne.loadBalancerSubnet.placeholder') value=config.loadBalancersubnet}}
                    {{/input-or-display}}
                  </div>
                  <div class="col span-6">
                    <label class="acc-label">{{t 'clusterNew.ociocne.workerNodeSubnet.label'}}{{field-required}}</label>
                    {{#input-or-display editable=(and (eq step 2) isNew) value=config.workerNodeSubnet}}
                      {{input type="text" classNames="form-control" placeholder=(t 'clusterNew.ociocne.workerNodeSubnet.placeholder') value=config.workerNodeSubnet}}
                    {{/input-or-display}}
                  </div>
                </div>
              {{/if}}
            {{/input-or-display}}
          </div>

        </div>

      {{/accordion-list-item}}
      {{#if (eq step 2)}}
        {{save-cancel editing=(eq mode 'edit')
                      save="saveNetworking"
                      cancel=close
                      createLabel="clusterNew.ociocne.networking.next"
                      savingLabel="clusterNew.ociocne.networking.loading"
        }}
      {{/if}}
    {{/if}}
    {{#if (gte step 3)}}
      {{#accordion-list-item title=(t "clusterNew.ociocne.cluster.title")
                             detail=(t "clusterNew.ociocne.cluster.detail")
                             showExpand=false
                             expandOnInit=true
                             expandAll=al.expandAll
                             expand=(action expandFn)
      }}
        <div class="row">
          <div class="col span-6">
            <label class="acc-label">
              {{t 'clusterNew.ociocne.imageDisplayName.label'}}{{field-required}}
            </label>
            {{#if (eq step 3)}}
              <select class="form-control" onchange={{action (mut config.nodeImages) value="target.value"}}>
                <option>  </option>
                {{#each nodeImages as |choice|}}
                  <option value={{choice}} selected={{eq config.imageDisplayName choice}}>{{choice}}</option>
                {{/each}}
              </select>
            {{else}}
              <div>{{config.imageDisplayName}}</div>
            {{/if}}
          </div>
        </div>
        <div class="row">
          <div class="col span-6">
            <label class="acc-label pt-5">{{t "clusterNew.ociocne.nodePublicKeyContents.label"}}{{field-required}}</label>
          </div>
          {{input-text-file
            classNames="box"
            value=config.nodePublicKeyContents
            multiple=False
            canChangeName=false
            accept="text/plain,.pub"
            minHeight=40
            placeholder="clusterNew.ociocne.nodePublicKeyContents.placeholder"
            shouldChangeName=false
            concealValue=true
          }}

        </div>
        {{#accordion-list-item title=(t "clusterNew.ociocne.controlplane.title")
                               detail=(t "clusterNew.ociocne.controlplane.detail")
                               showExpand=false
                               expandOnInit=true
                               expandAll=al.expandAll
                               expand=(action expandFn)
        }}
          <div class="row">
            <div class="col span-4 mb-0">
              <label class="acc-label">
                {{t 'clusterNew.ociocne.version.label'}}
              </label>
              {{#if (eq step 3)}}
                <select class="form-control" onchange={{action (mut config.kubernetesVersion) value="target.value"}}>
                  <option>  </option>
                  {{#each kubernetesVersions as |choice|}}
                    <option value={{choice}} selected={{eq config.kubernetesVersion choice}}>{{choice}}</option>
                  {{/each}}
                </select>
              {{else}}
                <div>{{config.kubernetesVersion}}</div>
              {{/if}}
            </div>
          </div>
          <div class="row">
            <div class="col span-4">
              <label class="acc-label">
                {{t 'clusterNew.ociocne.controlPlaneShape.label'}}{{field-required}}
              </label>
              {{#if (eq step 3)}}
                <select class="form-control" onchange={{action (mut config.nodeShapes) value="target.value"}}>
                  <option>  </option>
                  {{#each nodeShapes as |choice|}}
                    <option value={{choice}} selected={{eq config.controlPlaneShape choice}}>{{choice}}</option>
                  {{/each}}
                </select>
              {{else}}
                <div>{{config.controlPlaneShape}}</div>
              {{/if}}
            </div>
            <div class="col span-4 mb-0">
              <label class="acc-label">
                {{t 'clusterNew.ociocne.numControlPlaneNodes.label'}}
              </label>
              {{#input-or-display editable=(and (eq step 3) isNew) value=config.numControlPlaneNodes}}
                {{input-integer min=1 max=maxNodeCount value=config.numControlPlaneNodes classNames="form-control" placeholder=(t 'clusterNew.ociocne.numControlPlaneNodes.placeholder')}}
                <p class="help-block">
                  {{t 'clusterNew.ociocne.numControlPlaneNodes.help'}}
                </p>
              {{/input-or-display}}
            </div>
          </div>
          <div class="row">
            <div class="col span-4 mb-0">
              <label class="acc-label">
                {{t 'clusterNew.ociocne.controlPlaneOcpus.label'}}
              </label>
              {{#input-or-display editable=(and (eq step 3) isNew) value=config.controlPlaneOcpus}}
                {{input-integer min=1 max=maxNodeCount value=config.controlPlaneOcpus classNames="form-control" placeholder=(t 'clusterNew.ociocne.controlPlaneOcpus.placeholder')}}
                <p class="help-block">
                  {{t 'clusterNew.ociocne.controlPlaneOcpus.help'}}
                </p>
              {{/input-or-display}}
            </div>
            <div class="col span-4 mb-0">
              <label class="acc-label">
                {{t 'clusterNew.ociocne.controlPlaneMemoryGbs.label'}}
              </label>
              {{#input-or-display editable=(and (eq step 3) isNew) value=config.controlPlaneMemoryGbs}}
                {{input-integer min=2 max=maxNodeCount value=config.controlPlaneMemoryGbs classNames="form-control" placeholder=(t 'clusterNew.ociocne.controlPlaneMemoryGbs.placeholder')}}
                <p class="help-block">
                  {{t 'clusterNew.ociocne.controlPlaneMemoryGbs.help'}}
                </p>
              {{/input-or-display}}
            </div>
          </div>
        {{/accordion-list-item}}
        {{#accordion-list-item title=(t "clusterNew.ociocne.workers.title")
                               detail=(t "clusterNew.ociocne.workers.detail")
                               showExpand=false
                               expandOnInit=true
                               expandAll=al.expandAll
                               expand=(action expandFn)
        }}
          <div class="row">
            <div class="col span-4">
              <label class="acc-label">
                {{t 'clusterNew.ociocne.nodeShape.label'}}{{field-required}}
              </label>
              {{#if (eq step 3)}}
                <select class="form-control" onchange={{action (mut config.nodeShapes) value="target.value"}}>
                  <option>  </option>
                  {{#each nodeShapes as |choice|}}
                    <option value={{choice}} selected={{eq config.nodeShape choice}}>{{choice}}</option>
                  {{/each}}
                </select>
              {{else}}
                <div>{{config.nodeShape}}</div>
              {{/if}}
            </div>
            <div class="col span-4 mb-0">
              <label class="acc-label">
                {{t 'clusterNew.ociocne.numWorkerNodes.label'}}
              </label>
              {{#input-or-display editable=(and (eq step 3) isNew) value=config.numWorkerNodes}}
                {{input-integer min=1 max=maxNodeCount value=config.numWorkerNodes classNames="form-control" placeholder=(t 'clusterNew.ociocne.numWorkerNodes.placeholder')}}
                <p class="help-block">
                  {{t 'clusterNew.ociocne.numWorkerNodes.help'}}
                </p>
              {{/input-or-display}}
            </div>
          </div>
          <div class="row">
            <div class="col span-4 mb-0">
              <label class="acc-label">
                {{t 'clusterNew.ociocne.nodeOcpus.label'}}
              </label>
              {{#input-or-display editable=(and (eq step 3) isNew) value=config.nodeOcpus}}
                {{input-integer min=1 max=maxNodeCount value=config.nodeOcpus classNames="form-control" placeholder=(t 'clusterNew.ociocne.nodeOcpus.placeholder')}}
                <p class="help-block">
                  {{t 'clusterNew.ociocne.nodeOcpus.help'}}
                </p>
              {{/input-or-display}}
            </div>
            <div class="col span-4 mb-0">
              <label class="acc-label">
                {{t 'clusterNew.ociocne.nodeMemoryGbs.label'}}
              </label>
              {{#input-or-display editable=(and (eq step 3) isNew) value=config.nodeMemoryGbs}}
                {{input-integer min=2 max=maxNodeCount value=config.nodeMemoryGbs classNames="form-control" placeholder=(t 'clusterNew.ociocne.nodeMemoryGbs.placeholder')}}
                <p class="help-block">
                  {{t 'clusterNew.ociocne.nodeMemoryGbs.help'}}
                </p>
              {{/input-or-display}}
            </div>
          </div>
        {{/accordion-list-item}}
      {{/accordion-list-item}}
      {{#if (eq step 3)}}
        {{save-cancel editing=(eq mode 'edit')
                      save="save"
                      saveDisabled=canCreateCluster
                      cancel=close
        }}
      {{/if}}
    {{/if}}
  {{/if}}
  {{top-errors errors=errors}}
  {{top-errors errors=otherErrors}}
  {{top-errors errors=clusterErrors}}
{{/accordion-list}}
